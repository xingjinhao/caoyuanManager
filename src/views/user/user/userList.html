

<title>网站用户</title>
  
<div class="layui-card layadmin-header">
  <div class="layui-breadcrumb" lay-filter="breadcrumb">
    <a lay-href="">主页</a>
    <a><cite>用户</cite></a>
    <a><cite>网站用户</cite></a>
  </div>
</div>

<div class="layui-fluid">
  <div class="layui-card">
    <div class="layui-form layui-card-header layuiadmin-card-header-auto" lay-filter="layadmin-userfront-formlist">
      <div class="layui-form-item">
      	
      	<!--ID-->
        <div class="layui-inline">
          <label class="layui-form-label">ID</label>
          <div class="layui-input-block">
            <input type="text" name="id" placeholder="请输入" lay-verify="numbers" autocomplete="off" class="layui-input">
          </div>
        </div>
        
        <!--手机号-->
        <div class="layui-inline">
          <label class="layui-form-label">手机号</label>
          <div class="layui-input-block">
            <input type="text" name="phone" placeholder="请输入" lay-verify="numbers" autocomplete="off" class="layui-input">
          </div>
        </div>
        
        
        <br />
        
        
        <!--性别-->
        <div class="layui-inline">
          <label class="layui-form-label">性别</label>
          <div class="layui-input-block" style="width: 186px;">
            <select name="sex">
              <option value="">不限</option>
              <option value="1">男</option>
              <option value="2">女</option>
            </select>
          </div>
        </div>
        
        <!--地区-->
        <div class="layui-inline">
          <label class="layui-form-label">地区</label>
          <div class="layui-input-block">
            <input type="text" name="address" placeholder="请输入" autocomplete="off" class="layui-input">
          </div>
        </div>
        
        <!--占位框-->
        <div class="layui-inline"><div></div></div>
        
        <!--年龄-->
        <div class="layui-inline">
          <label class="layui-form-label">年龄</label>
          <div class="layui-input-block">
            <input type="text" name="age" placeholder="请输入" lay-verify="numbers"  autocomplete="off" class="layui-input">
          </div>
        </div>
        
        <br />
        
        <!--注册时间-->
        <div class="layui-inline">
          <label class="layui-form-label">注册时间</label>
          <div class="layui-input-inline" style="width: 176px;">
            <input class="layui-input layui-input-inline" style="width: 186px;" name="registerTime" id="registerTime" placeholder="起始时间  :  yyyy-MM-dd" autocomplete="off" >
          </div>
        </div>
        
        <!--登录时间-->
        <div class="layui-inline">
          <label class="layui-form-label">登录时间</label>
          <div class="layui-input-inline">
            <input class="layui-input layui-input-inline"  style="width: 186px;" name="loginTime" id="loginTime" placeholder="起始时间  :  yyyy-MM-dd" autocomplete="off" >
          </div>
        </div>
        
        <!--是否会员-->
        <div class="layui-inline">
          <label class="layui-form-label">是否会员</label>
          <div class="layui-input-block" style="width: 186px;">
            <select name="isVip">
              <option value="">不限</option>
              <option value="1">是</option>
              <option value="0">否</option>
            </select>
          </div>
        </div>
        
        <!--搜索按钮-->
        <div class="layui-inline">
          <button class="layui-btn layuiadmin-btn-useradmin" lay-submit lay-filter="LAY-user-front-search">
            <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
          </button>
        </div>
        
      </div>
    </div>
    
    <div class="layui-card-body">
      <table id="LAY-user-manage" lay-filter="LAY-user-manage"></table>
      
      <script type="text/html" id="imgTpl"> 
        <img style="display: inline-block; width: 50%; height: 100%;" src= {{ d.avatar }}>
      </script> 
      
      <!--是否会员-->
      <script type="text/html" id="isVip"> 
      	{{# if(d.isVip==1){ }}
			        是
			  {{#  } else { }}
			        否
			  {{# } }}
      </script> 
      
      <!--性别-->
      <script type="text/html" id="sex"> 
      	{{# if(d.sex==1){ }}
			        男
			  {{#  } else if(d.sex==2){ }}
			        女
			  {{#  } else { }}
			        暂无
			  {{# } }}
      </script> 
      
      <!--城市-->
      <script type="text/html" id="city"> 
      	{{# if(d.city==null || d.city==""){ }}
			       	 暂无
			  {{#  } else { }}
			        {{d.city}}
			  {{# } }}
      </script> 
      
      <!--出生日期-->
      <script type="text/html" id="birthday"> 
      	{{# if(d.birthday==null || d.birthday==""){ }}
			       	 暂无
			  {{#  } else { }}
			        {{d.birthday}}
			  {{# } }}
      </script> 
      
      <!--会员到期时间-->
      <script type="text/html" id="vipDueTime"> 
      	{{# if(d.vipDueTime==null || d.vipDueTime==""){ }}
			       	 暂无
			  {{#  } else { }}
			        {{d.vipDueTime}}
			  {{# } }}
      </script> 
      
      <script type="text/html" id="table-useradmin-webuser">
			    {{# if(d.state==1){ }}
			        <a class="layui-btn layui-btn-xs" lay-event="thawAccount">解冻账号</a>
			    {{#  } else { }}
			        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="frozenAccount">冻结账号</a>
			    {{# } }}
			    
			    {{# if(d.comState==1){ }}
			        <a class="layui-btn layui-btn-xs" lay-event="thawComment">解冻评论功能</a>
			    {{#  } else { }}
			        <a class="layui-btn layui-btn-warm layui-btn-xs" lay-event="frozenComment">冻结评论功能</a>
			    {{# } }}
			    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"><i class="layui-icon layui-icon-delete"></i>删除</a>
			</script>
    </div>
  </div>
</div>


<script>
layui.use('user', layui.factory('user')).use(['admin', 'useradmin', 'table','laydate','form'], function(){
  	var $ = layui.$
  	,admin = layui.admin
  	,view = layui.view
  	,table = layui.table
  	,laydate = layui.laydate
  	,form = layui.form;
  
  /*日期时间范围选择*/
	laydate.render({ 
	  elem: '#registerTime'
	  ,type: 'datetime'
	  ,range: true
	});
	
	/*日期时间范围选择*/
	laydate.render({ 
	  elem: '#loginTime'
	  ,type: 'datetime'
	  ,range: true
	});
	
	form.verify({
			numbers: function (value, item) {
	    var reg = '^[0-9]*$';
	    if (!new RegExp(reg).test(value)) {
	        return '只能填写整数';
	        }
	    }
	});
  /*监听搜索*/
  form.on('submit(LAY-user-front-search)', function(data){
    var field = data.field;
    console.log(field);
    var registerTime = field.registerTime;
    var loginTime = field.loginTime;
    var rt = registerTime.split(" - ");
    var lt = loginTime.split(" - ");
    table.reload('LAY-user-manage', {
    	  url:layui.setter.urll+'/api/admin/user/search'
    	  ,method:'get'
          ,where: {
             uid:field.id.replace(/\s*/g,"")			/*用户id*/
            ,phone:field.phone.replace(/\s*/g,"")		/*手机号*/
            ,sex:field.sex								/*性别*/
            ,city:field.address.replace(/\s*/g,"")		/*地区*/
            ,age:field.age.replace(/\s*/g,"")			/*年龄*/
            ,flag:field.isVip							/*是否会员*/
            ,start:rt[0]								/*注册起始时间*/
            ,end:rt[1]									/*注册结束时间*/
            ,signStart:lt[0]							/*登录起始时间*/
            ,signEnd:lt[1]								/*登录结束时间*/
        }
       ,page: true
    });
  });

  $('.layui-btn.layuiadmin-btn-useradmin').on('click', function(){
    var type = $(this).data('type');
    active[type] ? active[type].call(this) : '';
  });
});
</script>